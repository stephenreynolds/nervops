---
import BaseLayout from '../layouts/BaseLayout.astro';
import NavBar from '../components/NavBar.astro';
import HeroSection from '../components/HeroSection.astro';
import OverviewSection from '../components/OverviewSection.astro';
import AgentsSection from '../components/AgentsSection.astro';
import ProjectsSection from '../components/ProjectsSection.astro';
import CommandSection from '../components/CommandSection.astro';
---

<BaseLayout>
  <NavBar />
  <main>
    <HeroSection />
    <OverviewSection />
    <AgentsSection />
    <ProjectsSection />
    <CommandSection />
  </main>
</BaseLayout>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  gsap.utils.toArray('.reveal').forEach((el) => {
    gsap.fromTo(
      el,
      { y: 28, opacity: 0 },
      {
        y: 0,
        opacity: 1,
        duration: 0.85,
        ease: 'power2.out',
        scrollTrigger: {
          trigger: el,
          start: 'top 85%',
          once: true
        }
      }
    );
  });

  gsap.utils.toArray('.stat-value').forEach((stat) => {
    const target = Number(stat.getAttribute('data-count') || 0);
    const proxy = { value: 0 };

    gsap.to(proxy, {
      value: target,
      duration: 1.6,
      ease: 'power2.out',
      scrollTrigger: {
        trigger: stat,
        start: 'top 90%',
        once: true
      },
      onUpdate: () => {
        stat.textContent = Math.floor(proxy.value).toLocaleString();
      }
    });
  });
</script>
